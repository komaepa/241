// 1. ì´ˆê¸° ë°ì´í„° ì •ì˜
    let updateCount = 0; // 10ì´ˆë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ì—…ë°ì´íŠ¸ íšŸìˆ˜ ì¹´ìš´íŠ¸
    let chzzkBotEventCount = 0; // ë·°ë´‡ ì´ë²¤íŠ¸ ë°œìƒ íšŸìˆ˜ ì¹´ìš´íŠ¸ (ìµœëŒ€ 12íšŒ ì œí•œ ìš©ë„)
    let chzzkRestoreTimeout = null; // ì‹œì²­ì ë³µì› íƒ€ì´ë¨¸ë¥¼ ì €ì¥í•  ë³€ìˆ˜

    let soopData = {
        platformName: "SOOP (ìˆ²)",
        shortName: "SOOP",
        viewers: 172025,
        viewerChange: 0, 
        trend: [170, 168, 172, 175, 172, 169, 174, 171, 173, 172], // ì²œ ëª… ë‹¨ìœ„
        trendColor: '#007bff', // íŒŒë€ìƒ‰
        updateTime: ''
    };

    let chzzkData = {
        platformName: "ì¹˜ì§€ì§ (CHZZK)",
        shortName: "CHZZK",
        viewers: 60000, // ì´ˆê¸°ê°’ì„ 60000ìœ¼ë¡œ ì•½ê°„ ìƒí–¥ ì¡°ì •
        viewerChange: 0,
        trend: [50, 55, 52, 53, 58, 56, 54, 57, 53, 55], // ì²œ ëª… ë‹¨ìœ„
        trendColor: '#00c73c', // ì´ˆë¡ìƒ‰
        updateTime: ''
    };
    // (mockChannels ë°ì´í„°ëŠ” ì´ì „ê³¼ ë™ì¼)

    const mockChannels = [
        { name: "ì´ì„¸ê³„ì•„ì´ëŒ", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ H (ì´ì„¸ê³„)", platform: "SOOP", viewers: 20000, keywords: ["ì´ì„¸ê³„ì•„ì´ëŒ", "ë²„ì¸„ì–¼", "ê³ ì„¸êµ¬", "ë¦´íŒŒ", "ì§•ë²„ê±°", "ì£¼ë¥´ë¥´", "ë¹„ì±¤", "ì•„ì´ë„¤"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ B", detail: "ëŒ€í˜• ì¢…í•©ê²Œì„ (ì¹¨í„ë§¨)", platform: "CHZZK", viewers: 20438, keywords: ["ì¢…í•©ê²Œì„", "ì¹¨í„"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ C", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ C (ë¹„ì „)", platform: "SOOP", viewers: 24514, keywords: ["ë…¸ë˜", "Just Chatting"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ E", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ E (ë¡¤)", platform: "SOOP", viewers: 25438, keywords: ["ê²Œì„", "ë¡¤"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ G", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ G (ì•„ì´ëŒ)", platform: "CHZZK", viewers: 16512, keywords: ["ë²„ì¸„ì–¼", "ë…¸ë˜"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ D", detail: "ì£¼ì‹/ê²½ì œ ì „ë¬¸ê°€", platform: "CHZZK", viewers: 14000, keywords: ["ì£¼ì‹", "ê²½ì œ"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ F", detail: "ë¨¹ë°©/ì†Œí†µ ëŒ€ê°€", platform: "SOOP", viewers: 18000, keywords: ["ë¨¹ë°©", "ì†Œí†µ"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ I", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ I (ê³ ì„¸êµ¬)", platform: "SOOP", viewers: 15000, keywords: ["ì´ì„¸ê³„ì•„ì´ëŒ", "ë²„ì¸„ì–¼"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ J", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ J (ìš°ì™êµ³)", platform: "SOOP", viewers: 13000, keywords: ["ìš°ì™êµ³", "ì¢…í•©ê²Œì„"] },
        { name: "ìŠ¤íŠ¸ë¦¬ë¨¸ K", detail: "í”„ë¡œí•„ ìŠ¤íŠ¸ë¦¬ë¨¸ K (í’ì›”ëŸ‰)", platform: "CHZZK", viewers: 12000, keywords: ["í’ì›”ëŸ‰", "ê²Œì„"] },
    ];
    
    let soopChart, chzzkChart;
    let dataUpdateInterval;


    // 2. í—¬í¼ í•¨ìˆ˜: ë‚œìˆ˜ ìƒì„±
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // 3. CHZZK ì‹œì²­ì ìˆ˜ë¥¼ ì›ë˜ëŒ€ë¡œ ë³µì›í•˜ëŠ” í•¨ìˆ˜ (1ë¶„ í›„ ì‹¤í–‰)
    function restoreChzzkViewers() {
        const restoredViewers = getRandomInt(30000, 70000);
        
        const prevChzzkViewer = chzzkData.viewers;
        chzzkData.viewers = restoredViewers;
        chzzkData.viewerChange = chzzkData.viewers - prevChzzkViewer;

        chzzkData.trend.shift();
        chzzkData.trend.push(Math.round(chzzkData.viewers / 1000));

        chzzkData.updateTime = new Date().toLocaleTimeString('ko-KR');

        if (!document.getElementById('main-content').classList.contains('hidden')) {
            drawPlatformBox(chzzkData, 'chzzk-box');
            renderChannelList(mockChannels.sort((a, b) => b.viewers - a.air));
        }

        console.log("ğŸŸ¢ CHZZK ì‹œì²­ì ë³µì›: " + restoredViewers.toLocaleString() + "ëª…. í˜„ì¬ ì´ë²¤íŠ¸ íšŸìˆ˜: " + chzzkBotEventCount + "/12");
    }

    // 4. ë°ì´í„° ì—…ë°ì´íŠ¸ ë° ì¬ë Œë”ë§ ë©”ì¸ í•¨ìˆ˜ (10ì´ˆë§ˆë‹¤ ì‹¤í–‰)
    function updateDataAndRender() {
        updateCount++; 

        // A. í”Œë«í¼ ì‹œì²­ììˆ˜ ë° ì¶”ì´ ì—…ë°ì´íŠ¸
        const newSoopViewers = soopData.viewers + getRandomInt(-10000, 10000);
        soopData.viewers = Math.max(100000, newSoopViewers); 
        
        let newChzzkViewers = chzzkData.viewers + getRandomInt(-5000, 5000);

        // ğŸš¨ ì‹œì²­ì ê¸‰ë“± ë¡œì§: 50ì´ˆë§ˆë‹¤ (updateCount % 5 === 0) AND ì´ë²¤íŠ¸ íšŸìˆ˜ê°€ 12íšŒ ë¯¸ë§Œì¼ ë•Œ
        if (updateCount % 5 === 0 && chzzkBotEventCount < 12) {
            
            if (chzzkRestoreTimeout) {
                clearTimeout(chzzkRestoreTimeout);
                chzzkRestoreTimeout = null;
            }

            // 1. 10ë§Œ 5ì²œ ~ 11ë§Œ 5ì²œ ì‚¬ì´ë¡œ ê¸‰ë“±
            newChzzkViewers = getRandomInt(105000, 115000); 
            chzzkBotEventCount++; 
            console.warn("ğŸš¨ CHZZK ì‹œì²­ì ê¸‰ë“± ê°ì§€! (10ë§Œ ì´ˆê³¼): " + newChzzkViewers.toLocaleString() + "ëª…. ì´ë²¤íŠ¸ íšŸìˆ˜: " + chzzkBotEventCount + "/12");

            // 2. 1ë¶„(60ì´ˆ) í›„ ì‹œì²­ì ë³µì› í•¨ìˆ˜ ì‹¤í–‰ ì˜ˆì•½
            chzzkRestoreTimeout = setTimeout(restoreChzzkViewers, 60000); 

        } else if (chzzkData.viewers >= 100000) {
            // ë·°ë´‡ ì´ë²¤íŠ¸ ê¸°ê°„ ì¤‘ì´ë¼ë©´, ë†’ì€ ì‹œì²­ì ìˆ˜ë¥¼ ìœ ì§€ (ëœë¤ ë³€ë™)
            newChzzkViewers = Math.max(100000, newChzzkViewers); 
            newChzzkViewers = Math.min(120000, newChzzkViewers); 

        } else {
            // í‰ì†Œ ë³€ë™ (3ë§Œ ~ 7ë§Œ ì‚¬ì´ë¥¼ ìœ ì§€í•˜ë„ë¡ ì œí•œ)
            newChzzkViewers = Math.max(30000, newChzzkViewers);
            newChzzkViewers = Math.min(70000, newChzzkViewers);
        }
        
        chzzkData.viewers = newChzzkViewers;
        
        // ì¶”ì´ ë° ë³€ê²½ í­ ê³„ì‚° (ìƒëµ)
        // ... (ì´í•˜ ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ)
        const prevSoopViewer = soopData.trend[soopData.trend.length - 1] * 1000;
        const prevChzzkViewer = chzzkData.trend[chzzkData.trend.length - 1] * 1000;
        
        soopData.trend.shift();
        soopData.trend.push(Math.round(soopData.viewers / 1000));
        
        chzzkData.trend.shift();
        chzzkData.trend.push(Math.round(chzzkData.viewers / 1000));
        
        soopData.viewerChange = soopData.viewers - prevSoopViewer;
        chzzkData.viewerChange = chzzkData.viewers - prevChzzkViewer;

        soopData.updateTime = chzzkData.updateTime = new Date().toLocaleTimeString('ko-KR');

        // B. ìŠ¤íŠ¸ë¦¬ë¨¸ ì‹œì²­ì ìˆ˜ ì—…ë°ì´íŠ¸ (ê°€ìƒ ë°ì´í„°)
        let updatedChannels = [];
        mockChannels.forEach(channel => {
            const viewerChange = getRandomInt(-2000, 2000);
            const newViewers = Math.max(10000, channel.viewers + viewerChange);
            
            channel.viewers = newViewers;
            updatedChannels.push(channel);
        });

        const sortedChannels = updatedChannels.sort((a, b) => b.viewers - a.viewers);
        
        // C. ë Œë”ë§ (ë©”ì¸ ì½˜í…ì¸ ê°€ ë³´ì¼ ë•Œë§Œ)
        if (!document.getElementById('main-content').classList.contains('hidden')) {
            drawPlatformBox(soopData, 'soop-box');
            drawPlatformBox(chzzkData, 'chzzk-box');
            renderChannelList(sortedChannels);
        }
        
        // D. ë·°ë´‡ ê°ì§€ í™•ì¸
        checkBotDetection(); 

        // ì½˜ì†”ì— í˜„ì¬ ìƒíƒœ ë¡œê¹…
        console.log(`[${updateCount}íšŒ ì—…ë°ì´íŠ¸] SOOP: ${soopData.viewers.toLocaleString()}ëª…, CHZZK: ${chzzkData.viewers.toLocaleString()}ëª…`);
    }

    // 5. Chart.jsë¥¼ ì‚¬ìš©í•œ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ë° ë°•ìŠ¤ ë‚´ìš© ì±„ìš°ê¸° í•¨ìˆ˜ (ë³€ê²½ ì—†ìŒ)
    // ... (ì´í•˜ ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ)