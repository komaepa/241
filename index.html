// 1. 초기 데이터 정의
    let updateCount = 0; // 10초마다 실행되는 업데이트 횟수 카운트
    let chzzkBotEventCount = 0; // 뷰봇 이벤트 발생 횟수 카운트 (최대 12회 제한 용도)
    let chzzkRestoreTimeout = null; // 시청자 복원 타이머를 저장할 변수

    let soopData = {
        platformName: "SOOP (숲)",
        shortName: "SOOP",
        viewers: 172025,
        viewerChange: 0, 
        trend: [170, 168, 172, 175, 172, 169, 174, 171, 173, 172], // 천 명 단위
        trendColor: '#007bff', // 파란색
        updateTime: ''
    };

    let chzzkData = {
        platformName: "치지직 (CHZZK)",
        shortName: "CHZZK",
        viewers: 60000, // 초기값을 60000으로 약간 상향 조정
        viewerChange: 0,
        trend: [50, 55, 52, 53, 58, 56, 54, 57, 53, 55], // 천 명 단위
        trendColor: '#00c73c', // 초록색
        updateTime: ''
    };
    // (mockChannels 데이터는 이전과 동일)

    const mockChannels = [
        { name: "이세계아이돌", detail: "프로필 스트리머 H (이세계)", platform: "SOOP", viewers: 20000, keywords: ["이세계아이돌", "버츄얼", "고세구", "릴파", "징버거", "주르르", "비챤", "아이네"] },
        { name: "스트리머 B", detail: "대형 종합게임 (침펄맨)", platform: "CHZZK", viewers: 20438, keywords: ["종합게임", "침펄"] },
        { name: "스트리머 C", detail: "프로필 스트리머 C (비전)", platform: "SOOP", viewers: 24514, keywords: ["노래", "Just Chatting"] },
        { name: "스트리머 E", detail: "프로필 스트리머 E (롤)", platform: "SOOP", viewers: 25438, keywords: ["게임", "롤"] },
        { name: "스트리머 G", detail: "프로필 스트리머 G (아이돌)", platform: "CHZZK", viewers: 16512, keywords: ["버츄얼", "노래"] },
        { name: "스트리머 D", detail: "주식/경제 전문가", platform: "CHZZK", viewers: 14000, keywords: ["주식", "경제"] },
        { name: "스트리머 F", detail: "먹방/소통 대가", platform: "SOOP", viewers: 18000, keywords: ["먹방", "소통"] },
        { name: "스트리머 I", detail: "프로필 스트리머 I (고세구)", platform: "SOOP", viewers: 15000, keywords: ["이세계아이돌", "버츄얼"] },
        { name: "스트리머 J", detail: "프로필 스트리머 J (우왁굳)", platform: "SOOP", viewers: 13000, keywords: ["우왁굳", "종합게임"] },
        { name: "스트리머 K", detail: "프로필 스트리머 K (풍월량)", platform: "CHZZK", viewers: 12000, keywords: ["풍월량", "게임"] },
    ];
    
    let soopChart, chzzkChart;
    let dataUpdateInterval;


    // 2. 헬퍼 함수: 난수 생성
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // 3. CHZZK 시청자 수를 원래대로 복원하는 함수 (1분 후 실행)
    function restoreChzzkViewers() {
        const restoredViewers = getRandomInt(30000, 70000);
        
        const prevChzzkViewer = chzzkData.viewers;
        chzzkData.viewers = restoredViewers;
        chzzkData.viewerChange = chzzkData.viewers - prevChzzkViewer;

        chzzkData.trend.shift();
        chzzkData.trend.push(Math.round(chzzkData.viewers / 1000));

        chzzkData.updateTime = new Date().toLocaleTimeString('ko-KR');

        if (!document.getElementById('main-content').classList.contains('hidden')) {
            drawPlatformBox(chzzkData, 'chzzk-box');
            renderChannelList(mockChannels.sort((a, b) => b.viewers - a.air));
        }

        console.log("🟢 CHZZK 시청자 복원: " + restoredViewers.toLocaleString() + "명. 현재 이벤트 횟수: " + chzzkBotEventCount + "/12");
    }

    // 4. 데이터 업데이트 및 재렌더링 메인 함수 (10초마다 실행)
    function updateDataAndRender() {
        updateCount++; 

        // A. 플랫폼 시청자수 및 추이 업데이트
        const newSoopViewers = soopData.viewers + getRandomInt(-10000, 10000);
        soopData.viewers = Math.max(100000, newSoopViewers); 
        
        let newChzzkViewers = chzzkData.viewers + getRandomInt(-5000, 5000);

        // 🚨 시청자 급등 로직: 50초마다 (updateCount % 5 === 0) AND 이벤트 횟수가 12회 미만일 때
        if (updateCount % 5 === 0 && chzzkBotEventCount < 12) {
            
            if (chzzkRestoreTimeout) {
                clearTimeout(chzzkRestoreTimeout);
                chzzkRestoreTimeout = null;
            }

            // 1. 10만 5천 ~ 11만 5천 사이로 급등
            newChzzkViewers = getRandomInt(105000, 115000); 
            chzzkBotEventCount++; 
            console.warn("🚨 CHZZK 시청자 급등 감지! (10만 초과): " + newChzzkViewers.toLocaleString() + "명. 이벤트 횟수: " + chzzkBotEventCount + "/12");

            // 2. 1분(60초) 후 시청자 복원 함수 실행 예약
            chzzkRestoreTimeout = setTimeout(restoreChzzkViewers, 60000); 

        } else if (chzzkData.viewers >= 100000) {
            // 뷰봇 이벤트 기간 중이라면, 높은 시청자 수를 유지 (랜덤 변동)
            newChzzkViewers = Math.max(100000, newChzzkViewers); 
            newChzzkViewers = Math.min(120000, newChzzkViewers); 

        } else {
            // 평소 변동 (3만 ~ 7만 사이를 유지하도록 제한)
            newChzzkViewers = Math.max(30000, newChzzkViewers);
            newChzzkViewers = Math.min(70000, newChzzkViewers);
        }
        
        chzzkData.viewers = newChzzkViewers;
        
        // 추이 및 변경 폭 계산 (생략)
        // ... (이하 코드는 변경 없음)
        const prevSoopViewer = soopData.trend[soopData.trend.length - 1] * 1000;
        const prevChzzkViewer = chzzkData.trend[chzzkData.trend.length - 1] * 1000;
        
        soopData.trend.shift();
        soopData.trend.push(Math.round(soopData.viewers / 1000));
        
        chzzkData.trend.shift();
        chzzkData.trend.push(Math.round(chzzkData.viewers / 1000));
        
        soopData.viewerChange = soopData.viewers - prevSoopViewer;
        chzzkData.viewerChange = chzzkData.viewers - prevChzzkViewer;

        soopData.updateTime = chzzkData.updateTime = new Date().toLocaleTimeString('ko-KR');

        // B. 스트리머 시청자 수 업데이트 (가상 데이터)
        let updatedChannels = [];
        mockChannels.forEach(channel => {
            const viewerChange = getRandomInt(-2000, 2000);
            const newViewers = Math.max(10000, channel.viewers + viewerChange);
            
            channel.viewers = newViewers;
            updatedChannels.push(channel);
        });

        const sortedChannels = updatedChannels.sort((a, b) => b.viewers - a.viewers);
        
        // C. 렌더링 (메인 콘텐츠가 보일 때만)
        if (!document.getElementById('main-content').classList.contains('hidden')) {
            drawPlatformBox(soopData, 'soop-box');
            drawPlatformBox(chzzkData, 'chzzk-box');
            renderChannelList(sortedChannels);
        }
        
        // D. 뷰봇 감지 확인
        checkBotDetection(); 

        // 콘솔에 현재 상태 로깅
        console.log(`[${updateCount}회 업데이트] SOOP: ${soopData.viewers.toLocaleString()}명, CHZZK: ${chzzkData.viewers.toLocaleString()}명`);
    }

    // 5. Chart.js를 사용한 막대 그래프 그리기 및 박스 내용 채우기 함수 (변경 없음)
    // ... (이하 코드는 변경 없음)